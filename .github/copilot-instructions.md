# CAN 总线负载计算器 AI 指导

欢迎来到 CAN 总线负载计算器项目！本文档旨在帮助 AI 代理快速理解代码库并高效地做出贡献。

## 概述

这是一个简单的单页 Web 应用程序，允许用户根据 CAN 消息的频率、数据长度和数量来计算 CAN 总线的负载。该项目使用原生 HTML、CSS 和 JavaScript 构建，没有外部依赖项或构建步骤。

## 架构

项目遵循简单直接的静态网页架构：

-   `index.html`：定义了应用程序的结构，包括输入表单、消息表和结果显示区域。
-   `main.js`：包含所有应用程序逻辑。它处理用户输入，执行负载计算，并动态更新 DOM。
-   `styles.css`：为应用程序提供样式，包括浅色和深色模式的主题。

## 数据流

数据流是单向且由事件驱动的：

1.  用户在 `index.html` 的输入字段（波特率、频率、数据长度、帧数）中输入或修改数据。
2.  `main.js` 中的事件监听器会捕获这些更改。
3.  `calculateBusLoad()` 函数被调用以重新计算总线负载。
4.  计算出的负载会显示在页面上，并通过更新 ID 为 `load-result` 的 div 和 ID 为 `load-bar` 的进度条来更新。
5.  用户可以动态添加或删除消息行，`main.js` 会相应地更新 UI 和计算。
6.  最新的消息和波特率会保存在 `localStorage` 中，以便在页面重新加载后保持状态。

## 开发工作流程

-   **运行项目**：由于这是一个静态网站，您只需在 Web 浏览器中打开 `index.html` 文件即可。
-   **构建**：无需构建或编译步骤。
-   **测试**：目前没有自动化测试。测试是手动完成的。

## 关键代码模式和约定

### JavaScript (`main.js`)

-   **核心逻辑**：核心计算逻辑在 `calculateBusLoad()` 函数中。该函数迭代 `canMessages` 数组，根据每条消息的属性计算其比特率，然后汇总以确定总的总线负载百分比。
-   **DOM 操作**：脚本广泛使用 `document.getElementById()` 和事件委托来与 DOM 交互。UI 更新是通过直接操作元素的 `textContent` 和 `style` 属性来处理的。
-   **状态管理**：应用程序状态（消息列表和波特率）存储在全局 `canMessages` 数组和 `baudRate` 输入元素的值中。该状态会序列化为 JSON 并存储在 `localStorage` 中以实现持久性。
-   **常量**：`CONSTANTS` 对象用于定义应用程序范围内的常量，如最大数据长度和默认波特率。

### CSS (`styles.css`)

-   **CSS 变量**：样式表大量使用 CSS 变量（自定义属性）来定义颜色方案、字体大小和间距。这使得主题化（如浅色和深色模式）变得容易。
-   **深色模式**：深色模式是使用 `@media (prefers-color-scheme: dark)`媒体查询实现的，该查询会覆盖根 `:root` 元素中定义的 CSS 变量。
-   **响应式设计**：使用媒体查询来确保应用程序在较小的屏幕上（最大宽度 `48rem`）具有良好的可用性。

在进行更改时，请遵循这些模式和约定，以保持代码库的一致性和可维护性。
